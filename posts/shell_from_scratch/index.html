<!doctype html><html lang=en>
<head>
<title>Create Your Own Unix Like Shell :: Terminal</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="This post describes how you implement your own unix like shell from scratch accessing system calls through c programmig language">
<meta name=keywords content>
<meta name=robots content="noodp">
<link rel=canonical href=/posts/shell_from_scratch/>
<link rel=stylesheet href=/assets/style.css>
<link rel=stylesheet href=/assets/blue.css>
<link rel=stylesheet href=/style.css>
<link rel=apple-touch-icon href=/img/apple-touch-icon-192x192.png>
<link rel="shortcut icon" href=/img/favicon.ico>
<meta name=twitter:card content="summary">
<meta property="og:locale" content="en">
<meta property="og:type" content="article">
<meta property="og:title" content="Create Your Own Unix Like Shell">
<meta property="og:description" content="This post describes how you implement your own unix like shell from scratch accessing system calls through c programmig language">
<meta property="og:url" content="/posts/shell_from_scratch/">
<meta property="og:site_name" content="Terminal">
<meta property="og:image" content="/img/shell1.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<meta property="article:published_time" content="2020-12-21 00:00:00 +0000 UTC">
</head>
<body class=blue>
<div class="container center headings--one-size">
<header class=header>
<div class=header__inner>
<div class=header__logo>
<a href=/>
<div class=logo>
>Aayush Neupane
</div>
</a>
</div>
<div class=menu-trigger>menu</div>
</div>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/about>About</a></li>
<li><a href=/cv>CV</a></li>
<li><a href=/posts/>Posts</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/about>About</a></li>
<li><a href=/cv>CV</a></li>
<li><a href=/posts/>Posts</a></li>
</ul>
</nav>
</header>
<div class=content>
<div class=post>
<h1 class=post-title>
<a href=/posts/shell_from_scratch/>Create Your Own Unix Like Shell</a></h1>
<div class=post-meta>
<span class=post-date>
2020-12-21
[Updated: 2020-12-21]
</span>
<span class=post-author>:: Aayush Neupane</span>
<span class=post-reading-time>:: 3 min read (592 words)</span>
</div>
<img style="margin:0 auto" src=/img/shell1.png class=post-cover alt="Create Your Own Unix Like Shell" title="Cover Image">
<div class=post-content><div>
<h3 id=major-concepts-of-shell>Major concepts of shell<a href=#major-concepts-of-shell class=hanchor arialabel=Anchor>&#8983;</a> </h3>
<p>shell is a interpreter that interprets our command and convert them to respective systemcall or start some process from binary.
we type command in the terminal and shell gets its input from the terminal.</p>
<p>commands can be executed from shell in two ways one is to call the binary associated with the command, other is shell builtins, shell builtins are the command that live inside the shell code and our current process need not to fork before executing builtin command.</p>
<h2 id=how-shell-executes-non-builtin-code>How shell executes non builtin code?<a href=#how-shell-executes-non-builtin-code class=hanchor arialabel=Anchor>&#8983;</a> </h2>
<p>when we execute the command that is not a builtin command we use fork() syscall which creates two processes, one we call child process and other we call parent process, <code>fork()</code> method returns two times once to the parent process and other to the child process,</p>
<ul>
<li>fork returns 0 to the child process.</li>
<li>fork return process id of child to the parent process
so, by this return value of fork() method we can determing where we are in parent
process or child one.</li>
</ul>
<p>Now that we have covered how fork() system call work we will now cover how does execution of non-builtin command take place in the shell. When we try to execute the non builtin command, our main process is forked into two processes child and parent, in the child process replaced by new process by <code>exec()</code> system call. in the parent process we wait for child process to complete by using <code>wait()</code> system call. The shell spawns a child process using exec and waits for it to complete, then continues with its own execution.</p>
<p>when we call <code>exec()</code> function in our code process calling the <code>exec()</code> function is wiped out of the memory and replaced by the next process that we want to execute. so <code>exec()</code> function never return except on error, and code below the exec function will never execute because the process that contain exec function is wiped out of the memory by the new process</p>
<p>When you call a <code>exec()</code> family method it doesn&rsquo;t create a new process, instead <code>exec()</code> replaces the current process memory and instruction set etc with the process you want to run.</p>
<h3 id=shell-pipes>Shell Pipes<a href=#shell-pipes class=hanchor arialabel=Anchor>&#8983;</a> </h3>
<p>Pipes are the feature provided by an operating system for interprocess communication,The Unix/Linux systems allow stdout of a command to be connected to stdin of another command. We can make it do so by using the pipe character ‘|’.Pipe is used to combine two or more commands, and in this, the output of one command acts as input to another command, and this command’s output may act as input to the next command and so on</p>
<p>in our shell we implemented this using two new system calls <code>dup2()</code> and <code>pipe()</code></p>
<p><code>dup2(int oldfd,int newfd)</code>:The dup() system call creates a copy of the file descriptor oldfd, using the newfd</p>
<p><code>pipe(int pipefd[2])</code>:The array pipefd is used to
return two file descriptors referring to the ends of the pipe. pipefd[0] refers to the read end of the pipe. pipefd[1] refers to
the write end of the pipe.</p>
<p>To implement pipes we loop through each pipelined command connecting stdout of one command to the std in of the other command, logic for this can be found in <code>pipes_implementation.h</code> file of this project.</p>
<h3 id=how-to-know-more-about-syscalls>How to know more about syscalls?<a href=#how-to-know-more-about-syscalls class=hanchor arialabel=Anchor>&#8983;</a> </h3>
<p>For specific syscalls</p>
<ul>
<li>man fork</li>
<li>man exec</li>
<li>main wait</li>
</ul>
<p>To view all syscalls</p>
<ul>
<li>man syscalls</li>
</ul>
<p>some useful links to understand why <code>fork()</code> and <code>exec()</code> calls are used to create new processes in unix based system</p>
<p><a href=https://www.google.comhttps://askubuntu.com/a/428460/942407>Why use fork and exec?</a></p>
<p><a href=https://unix.stackexchange.com/a/136673/444490>why fork and exec?</a></p>
<p><a href=https://github.com/Atomnp/Shell_from_scratch>implementation code</a></p>
</div></div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=/posts/bayes_theorem/>
<span class=button__icon>←</span>
<span class=button__text>Intuitive explanation of Conditional Probability and Bayes theorem</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class=copyright>
<span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
</div>
</div>
</footer>
<script src=/assets/main.js></script>
<script src=/assets/prism.js></script>
</div>
</body>
</html>